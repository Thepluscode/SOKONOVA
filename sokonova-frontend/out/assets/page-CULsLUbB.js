import{d as R,g as I,r as n,u as U,j as e,L as H}from"./index-ZpOvIOBK.js";import{H as O,F as A}from"./Footer-Cn1l-7sc.js";import{B as N}from"./Button-BDm5bFDW.js";import{I as Q}from"./Input-B7PDevgZ.js";import{o as _}from"./ordersService-BApS7xkL.js";import{f as D}from"./fulfillmentService-CfEyVEUY.js";const T=o=>{const c=o.map(l=>l.status);return c.every(l=>l==="delivered")?"delivered":c.some(l=>l==="shipped")?"shipped":c.some(l=>l==="processing")?"processing":"pending"},z=o=>`https://api.dicebear.com/8.x/initials/svg?seed=${encodeURIComponent(o)}`;function Y(){const{user:o}=R();I("SELLER");const[c,l]=n.useState("all"),[g,P]=n.useState(""),[m,y]=n.useState([]),[x,v]=n.useState([]),[F,b]=n.useState(!0),[w,k]=n.useState(null),[S,f]=n.useState(null),{showToast:j}=U();n.useEffect(()=>{async function s(){b(!0),k(null);try{const r=(await _.listForSeller()).map(a=>{const i=(a.items||[]).map(d=>({id:d.id,name:d.product?.title||"Product",quantity:d.qty||0,price:Number(d.price||0),image:d.product?.imageUrl||"",status:d.fulfillmentStatus?.toLowerCase()||"pending",trackingNumber:d.trackingCode||null,carrier:d.carrier||null})),u=a.user?.name||a.user?.email||"Buyer",h=T(i);return{id:a.id,customer:{name:u,email:a.user?.email||"buyer@email.com",avatar:z(u)},items:i,total:Number(a.total||0),status:h,paymentStatus:(a.status||"pending").toLowerCase()==="paid"?"paid":"pending",shippingAddress:a.shippingAdr||"Shipping address not provided",orderDate:a.createdAt}});v(r)}catch(t){console.error("Failed to load seller orders:",t),k("Could not load orders. Please try again.")}finally{b(!1)}}s()},[]);const C=s=>{switch(s){case"pending":return"text-yellow-600 bg-yellow-100";case"processing":return"text-blue-600 bg-blue-100";case"shipped":return"text-purple-600 bg-purple-100";case"delivered":return"text-green-600 bg-green-100";case"cancelled":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},M=s=>{switch(s){case"paid":return"text-green-600 bg-green-100";case"pending":return"text-yellow-600 bg-yellow-100";case"failed":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},p=n.useMemo(()=>x.filter(s=>{const t=s.id.toLowerCase().includes(g.toLowerCase())||s.customer.name.toLowerCase().includes(g.toLowerCase()),r=c==="all"||s.status===c;return t&&r}),[x,g,c]),$=s=>{y(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},L=s=>{console.log(`Bulk action: ${s} for orders:`,m),y([])},E=(s,t,r)=>{v(a=>a.map(i=>{if(i.id!==s)return i;const u=i.items.map(h=>h.id===t?{...h,...r}:h);return{...i,items:u,status:T(u)}}))},q=async(s,t)=>{if(!o?.id)return;const r=prompt("Enter carrier (e.g. DHL, FedEx):")||"",a=prompt("Enter tracking number:")||"";if(!a.trim()){j({message:"Tracking number is required to mark as shipped.",type:"warning"});return}f(t);try{await D.markShipped(t,{carrier:r,trackingCode:a}),E(s,t,{status:"shipped",trackingNumber:a,carrier:r||"Carrier"})}catch(i){console.error("Failed to mark item shipped:",i),j({message:"Could not mark item as shipped. Please try again.",type:"error"})}finally{f(null)}},B=async(s,t)=>{if(!o?.id)return;const r=prompt("Optional: paste delivery proof URL")||"";f(t);try{await D.markDelivered(t,{proofUrl:r}),E(s,t,{status:"delivered"})}catch(a){console.error("Failed to mark item delivered:",a),j({message:"Could not mark item as delivered. Please try again.",type:"error"})}finally{f(null)}};return F?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(O,{}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsx("p",{className:"text-gray-600",children:"Loading orders..."})}),e.jsx(A,{})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(O,{}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(H,{to:"/seller-dashboard",className:"text-gray-600 hover:text-gray-900",children:e.jsx("i",{className:"ri-arrow-left-line text-xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Order Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage and track all your orders"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[m.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[m.length," selected"]}),e.jsx(N,{variant:"outline",onClick:()=>L("mark_shipped"),children:"Mark as Shipped"}),e.jsx(N,{variant:"outline",onClick:()=>L("export"),children:"Export"})]}),e.jsxs(N,{variant:"outline",children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Export Orders"]})]})]})})}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-6",children:[{id:"all",label:"All Orders",count:x.length},{id:"pending",label:"Pending",count:x.filter(s=>s.status==="pending").length},{id:"processing",label:"Processing",count:x.filter(s=>s.status==="processing").length},{id:"shipped",label:"Shipped",count:x.filter(s=>s.status==="shipped").length},{id:"delivered",label:"Delivered",count:x.filter(s=>s.status==="delivered").length}].map(s=>e.jsxs("button",{onClick:()=>l(s.id),className:`px-3 py-2 text-sm font-medium rounded-lg transition-colors ${c===s.id?"bg-emerald-100 text-emerald-700":"text-gray-600 hover:bg-gray-100"}`,children:[s.label,e.jsxs("span",{className:"ml-2 text-xs",children:["(",s.count,")"]})]},s.id))}),e.jsx("div",{className:"w-64",children:e.jsx(Q,{type:"text",placeholder:"Search orders...",value:g,onChange:s=>P(s.target.value),className:"w-full"})})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[w&&e.jsx("div",{className:"mb-6 text-sm text-red-600",children:w}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:m.length===p.length&&p.length>0,onChange:s=>{s.target.checked?y(p.map(t=>t.id)):y([])},className:"w-4 h-4 text-emerald-600 border-gray-300 rounded focus:ring-emerald-500"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Items"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:m.includes(s.id),onChange:()=>$(s.id),className:"w-4 h-4 text-emerald-600 border-gray-300 rounded focus:ring-emerald-500"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.id}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(s.orderDate).toLocaleDateString()})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:s.customer.avatar,alt:s.customer.name,className:"w-8 h-8 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.customer.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.customer.email})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"space-y-3",children:s.items.map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[t.image?e.jsx("img",{src:t.image,alt:t.name,className:"w-8 h-8 rounded object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded bg-gray-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Qty: ",t.quantity]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${C(t.status)}`,children:t.status}),e.jsx("button",{onClick:()=>q(s.id,t.id),className:"text-blue-600 hover:text-blue-900 text-sm",disabled:t.status==="shipped"||t.status==="delivered"||S===t.id,title:"Mark shipped",children:e.jsx("i",{className:"ri-truck-line"})}),e.jsx("button",{onClick:()=>B(s.id,t.id),className:"text-green-600 hover:text-green-900 text-sm",disabled:t.status!=="shipped"||S===t.id,title:"Mark delivered",children:e.jsx("i",{className:"ri-check-line"})})]})]},t.id))})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("p",{className:"font-medium text-gray-900",children:["$",s.total]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${C(s.status)}`,children:s.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${M(s.paymentStatus)}`,children:s.paymentStatus})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{className:"text-gray-600 hover:text-gray-900 text-sm",children:e.jsx("i",{className:"ri-more-line"})})})})]},s.id))})]})}),p.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-shopping-bag-line text-4xl text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No orders found matching your criteria."})]})]})]}),e.jsx(A,{})]})}export{Y as default};
//# sourceMappingURL=page-CULsLUbB.js.map
