import{d as H,i as _,r,j as e,L as U}from"./index-BuEVh5sI.js";import{H as z,F as T}from"./Footer-BUHV-7DN.js";import{B as u}from"./Button-CIhQbQx6.js";import{I as Y}from"./Input-CedIw5Ms.js";import{o as V}from"./ordersService-CeTZsDpa.js";import{p as g}from"./payoutsService-DA6fStpI.js";function te(){const{user:p}=H();_("SELLER");const[m,C]=r.useState("overview"),[R,h]=r.useState(!1),[B,j]=r.useState(!1),[o,v]=r.useState(""),[b,w]=r.useState(""),[P,n]=r.useState(""),[G,S]=r.useState(!0),[f,A]=r.useState(!1),[J,D]=r.useState(null),[a,$]=r.useState({availableBalance:0,pendingEarnings:0,totalPaidOut:0,nextPayoutDate:new Date(Date.now()+10080*60*1e3).toISOString(),minimumPayout:50,commissionRate:10}),[k,L]=r.useState([]),[M,F]=r.useState([]),y=[{id:"1",type:"bank",details:"Bank Account ****4532",isDefault:!0},{id:"2",type:"mobile_money",details:"M-Pesa +254 *** *** 789",isDefault:!1},{id:"3",type:"paypal",details:"seller@email.com",isDefault:!1}];r.useEffect(()=>{async function t(){if(p?.id){S(!0),D(null);try{const[l,d]=await Promise.all([g.getSummary().catch(()=>null),g.getHistory().catch(()=>[])]);l&&$(s=>({...s,availableBalance:l.available||0,pendingEarnings:l.pending||0,totalPaidOut:l.totalPaidOut||0})),d&&d.length>0&&L(d.map(s=>({id:s.id,amount:s.amount,commission:s.amount*.1,netAmount:s.amount*.9,status:s.status,method:s.method||"Bank Account",requestedAt:s.createdAt,processedAt:s.paidAt})));try{const s=await V.listForSeller();s&&s.length>0&&F(s.map(i=>({orderId:i.id,productName:i.items?.[0]?.product?.title||"Product",orderAmount:Number(i.total),commission:Number(i.total)*.1,netEarning:Number(i.total)*.9,status:i.paymentStatus==="PAID"?"available":"pending",orderDate:i.createdAt})))}catch{}}catch(l){console.error("Failed to fetch payout data:",l),D("Could not load payout data. Please try again.")}finally{S(!1)}}}t()},[p?.id]);const N=t=>{switch(t){case"completed":case"paid_out":return"text-green-600 bg-green-100";case"processing":return"text-blue-600 bg-blue-100";case"pending":case"available":return"text-yellow-600 bg-yellow-100";case"failed":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},E=t=>{switch(t){case"bank":return"ri-bank-line";case"mobile_money":return"ri-smartphone-line";case"paypal":return"ri-paypal-line";default:return"ri-wallet-line"}},q=async()=>{const t=parseFloat(o);if(t<a.minimumPayout){n(`Minimum payout amount is $${a.minimumPayout}`);return}if(t>a.availableBalance){n("Insufficient balance.");return}if(!b){n("Please select a payout method.");return}if(!p?.id){n("You must be logged in to request a payout.");return}A(!0),n("");try{const l=y.find(s=>s.id===b);await g.requestPayout(p.id,t,l?.type||"bank"),$(s=>({...s,availableBalance:s.availableBalance-t,pendingEarnings:s.pendingEarnings+t})),h(!1),v(""),w("");const d=await g.getHistory();d&&d.length>0&&L(d.map(s=>({id:s.id,amount:s.amount,commission:s.amount*.1,netAmount:s.amount*.9,status:s.status,method:s.method||"Bank Account",requestedAt:s.createdAt,processedAt:s.paidAt})))}catch(l){console.error("Failed to request payout:",l),n(l.message||"Failed to request payout. Please try again.")}finally{A(!1)}},I=()=>{n(""),h(!0)},O=()=>{const t=["Order ID","Product","Order Amount","Commission","Net Earning","Status","Date"],l=M.map(c=>[c.orderId,c.productName,`$${c.orderAmount.toFixed(2)}`,`$${c.commission.toFixed(2)}`,`$${c.netEarning.toFixed(2)}`,c.status,new Date(c.orderDate).toLocaleDateString()]),d=[t.join(","),...l.map(c=>c.join(","))].join(`
`),s=new Blob([d],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(s),x=document.createElement("a");x.href=i,x.download=`earnings-${Date.now()}.csv`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(i)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(z,{}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(U,{to:"/seller-dashboard",className:"text-gray-600 hover:text-gray-900",children:e.jsx("i",{className:"ri-arrow-left-line text-xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Payouts & Earnings"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your earnings and payout methods"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(u,{variant:"outline",onClick:O,children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Export CSV"]}),e.jsxs(u,{onClick:I,children:[e.jsx("i",{className:"ri-wallet-3-line mr-2"}),"Request Payout"]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-lg p-6 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium opacity-90",children:"Available Balance"}),e.jsx("i",{className:"ri-wallet-3-line text-xl opacity-80"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-1",children:["$",a.availableBalance.toLocaleString()]}),e.jsx("p",{className:"text-emerald-100 text-sm",children:"Ready to withdraw"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border-2 border-yellow-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Pending Earnings"}),e.jsx("i",{className:"ri-time-line text-xl text-yellow-600"})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 mb-1",children:["$",a.pendingEarnings.toLocaleString()]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Processing orders"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Total Paid Out"}),e.jsx("i",{className:"ri-check-double-line text-xl text-green-600"})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 mb-1",children:["$",a.totalPaidOut.toLocaleString()]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Lifetime earnings"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Commission Rate"}),e.jsx("i",{className:"ri-percent-line text-xl text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 mb-1",children:[a.commissionRate,"%"]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Platform fee"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm mb-8",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",children:[{id:"overview",label:"Overview",icon:"ri-dashboard-line"},{id:"history",label:"Payout History",icon:"ri-history-line"},{id:"earnings",label:"Earnings Details",icon:"ri-money-dollar-circle-line"},{id:"methods",label:"Payout Methods",icon:"ri-bank-card-line"}].map(t=>e.jsxs("button",{onClick:()=>C(t.id),className:`flex items-center py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${m===t.id?"border-emerald-500 text-emerald-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:`${t.icon} mr-2`}),t.label]},t.id))})}),e.jsxs("div",{className:"p-6",children:[m==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("i",{className:"ri-information-line text-blue-600 text-xl mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Payout Schedule"}),e.jsxs("p",{className:"text-sm text-blue-800",children:["Payouts are processed weekly. Your next scheduled payout is on"," ",e.jsx("strong",{children:new Date(a.nextPayoutDate).toLocaleDateString()}),". Minimum payout amount is $",a.minimumPayout,"."]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Payouts"}),e.jsx("div",{className:"space-y-3",children:k.slice(0,3).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["$",t.netAmount.toLocaleString()]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.method}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.requestedAt).toLocaleDateString()})]}),e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${N(t.status)}`,children:t.status})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Payout Methods"}),e.jsxs("div",{className:"space-y-3",children:[y.map(t=>e.jsx("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-lg flex items-center justify-center",children:e.jsx("i",{className:`${E(t.type)} text-xl text-gray-700`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.details}),t.isDefault&&e.jsx("span",{className:"text-xs text-emerald-600 font-medium",children:"Default"})]})]})},t.id)),e.jsxs("button",{onClick:()=>j(!0),className:"w-full p-4 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-emerald-500 hover:text-emerald-600 transition-colors",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Add Payment Method"]})]})]})]})]}),m==="history"&&e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Payout ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Commission"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Net Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Method"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.id}),t.transactionId&&e.jsx("p",{className:"text-xs text-gray-500",children:t.transactionId})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-900",children:["$",t.amount.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-red-600",children:["-$",t.commission.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-gray-900",children:["$",t.netAmount.toLocaleString()]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:t.method}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${N(t.status)}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:new Date(t.requestedAt).toLocaleDateString()})]},t.id))})]})})}),m==="earnings"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("select",{className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500",children:[e.jsx("option",{children:"All Status"}),e.jsx("option",{children:"Available"}),e.jsx("option",{children:"Pending"}),e.jsx("option",{children:"Paid Out"})]})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Order ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Order Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Commission"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Net Earning"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:M.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-gray-900",children:t.orderId}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.productName}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-900",children:["$",t.orderAmount.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-red-600",children:["-$",t.commission.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-green-600",children:["$",t.netEarning.toLocaleString()]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${N(t.status)}`,children:t.status.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:new Date(t.orderDate).toLocaleDateString()})]},t.orderId))})]})})]}),m==="methods"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:y.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:`${E(t.type)} text-2xl text-gray-700`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.details}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:t.type.replace("_"," ")})]})]}),t.isDefault&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium text-emerald-600 bg-emerald-100 rounded-full",children:"Default"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!t.isDefault&&e.jsx(u,{variant:"outline",className:"flex-1",children:"Set as Default"}),e.jsx("button",{className:"px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx("i",{className:"ri-delete-bin-line"})})]})]},t.id))}),e.jsxs("button",{onClick:()=>j(!0),className:"w-full p-6 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-emerald-500 hover:text-emerald-600 transition-colors",children:[e.jsx("i",{className:"ri-add-line text-2xl mb-2"}),e.jsx("p",{className:"font-medium",children:"Add New Payment Method"}),e.jsx("p",{className:"text-sm",children:"Bank account, mobile money, or PayPal"})]})]})]})]})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-black bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Request Payout"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Balance"}),e.jsxs("p",{className:"text-3xl font-bold text-emerald-600",children:["$",a.availableBalance.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payout Amount"}),e.jsx(Y,{type:"number",placeholder:`Minimum $${a.minimumPayout}`,value:o,onChange:t=>{v(t.target.value),n("")},min:a.minimumPayout,max:a.availableBalance}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Minimum: $",a.minimumPayout," â€¢ Maximum: $",a.availableBalance]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payout Method"}),e.jsxs("select",{value:b,onChange:t=>{w(t.target.value),n("")},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500",children:[e.jsx("option",{value:"",children:"Select method"}),y.map(t=>e.jsxs("option",{value:t.id,children:[t.details," ",t.isDefault?"(Default)":""]},t.id))]})]}),o&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Payout Amount"}),e.jsxs("span",{className:"font-medium",children:["$",parseFloat(o).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Commission (",a.commissionRate,"%)"]}),e.jsxs("span",{className:"text-red-600",children:["-$",(parseFloat(o)*a.commissionRate/100).toFixed(2)]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-2 flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"You'll Receive"}),e.jsxs("span",{className:"font-bold text-emerald-600",children:["$",(parseFloat(o)*(1-a.commissionRate/100)).toFixed(2)]})]})]}),P&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:P}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx(u,{variant:"outline",onClick:()=>h(!1),disabled:f,className:"flex-1",children:"Cancel"}),e.jsx(u,{onClick:q,disabled:f,className:"flex-1",children:f?"Processing...":"Request Payout"})]})]})]})}),B&&e.jsx("div",{className:"fixed inset-0 bg-black bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Add Payment Method"}),e.jsx("button",{onClick:()=>j(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{className:"p-4 border-2 border-gray-300 rounded-lg hover:border-emerald-500 hover:bg-emerald-50 transition-colors",children:[e.jsx("i",{className:"ri-bank-line text-2xl text-gray-700 mb-2"}),e.jsx("p",{className:"text-sm font-medium",children:"Bank"})]}),e.jsxs("button",{className:"p-4 border-2 border-gray-300 rounded-lg hover:border-emerald-500 hover:bg-emerald-50 transition-colors",children:[e.jsx("i",{className:"ri-smartphone-line text-2xl text-gray-700 mb-2"}),e.jsx("p",{className:"text-sm font-medium",children:"M-Pesa"})]}),e.jsxs("button",{className:"p-4 border-2 border-gray-300 rounded-lg hover:border-emerald-500 hover:bg-emerald-50 transition-colors",children:[e.jsx("i",{className:"ri-paypal-line text-2xl text-gray-700 mb-2"}),e.jsx("p",{className:"text-sm font-medium",children:"PayPal"})]})]}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Select a payment method type to continue"})]})]})}),e.jsx(T,{})]})}export{te as default};
//# sourceMappingURL=page-BP1bqVaH.js.map
