{"version":3,"file":"page-8w6kvp8A.js","sources":["../../src/lib/services/notificationsService.ts","../../src/pages/account/notifications/page.tsx"],"sourcesContent":["// Notifications Service - API integration for notifications module\n\nimport api, { buildQuery } from '../api';\nimport type { Notification } from '../types';\n\ninterface NotificationFilters {\n    limit?: number;\n    unreadOnly?: boolean;\n}\n\nexport const notificationsService = {\n    /**\n     * List notifications for user\n     * GET /notifications?userId=...&limit=...&unreadOnly=...\n     */\n    list: async (userId: string, filters?: NotificationFilters): Promise<Notification[]> => {\n        const params = {\n            userId,\n            limit: filters?.limit,\n            unreadOnly: filters?.unreadOnly,\n        };\n        const query = buildQuery(params as Record<string, string | number | boolean | undefined>);\n        return api.get<Notification[]>(`/notifications${query}`);\n    },\n\n    /**\n     * Get unread notification count\n     * GET /notifications/unread-count?userId=...\n     */\n    getUnreadCount: async (userId: string): Promise<{ count: number }> => {\n        return api.get<{ count: number }>(`/notifications/unread-count?userId=${userId}`);\n    },\n\n    /**\n     * Mark notification as read\n     * POST /notifications/:id/read\n     */\n    markRead: async (id: string, userId: string): Promise<{ success: boolean }> => {\n        return api.post<{ success: boolean }>(`/notifications/${id}/read`, { userId });\n    },\n\n    /**\n     * Mark all notifications as read\n     * POST /notifications/mark-all-read\n     */\n    markAllRead: async (userId: string): Promise<{ success: boolean }> => {\n        return api.post<{ success: boolean }>('/notifications/mark-all-read', { userId });\n    },\n\n    /**\n     * Delete notification\n     * POST /notifications/:id/delete\n     */\n    delete: async (id: string, userId: string): Promise<{ success: boolean }> => {\n        return api.post<{ success: boolean }>(`/notifications/${id}/delete`, { userId });\n    },\n};\n\nexport default notificationsService;\n","import { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport Header from '../../../components/feature/Header';\nimport Footer from '../../../components/feature/Footer';\nimport SkeletonLoader from '../../../components/base/SkeletonLoader';\nimport { notificationsService } from '../../../lib/services';\nimport { useAuth } from '../../../lib/auth';\n\ntype NotificationType = 'all' | 'orders' | 'promotions' | 'system';\n\ninterface Notification {\n  id: string;\n  type: NotificationType;\n  title: string;\n  message: string;\n  time: string;\n  read: boolean;\n  icon: string;\n  iconColor: string;\n}\n\nexport default function NotificationsPage() {\n  const { user } = useAuth();\n  const [activeFilter, setActiveFilter] = useState<NotificationType>('all');\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  // Fetch notifications from API\n  useEffect(() => {\n    async function fetchNotifications() {\n      if (!user?.id) {\n        setLoading(false);\n        return;\n      }\n\n      setLoading(true);\n      try {\n        const apiNotifications = await notificationsService.list(user.id);\n\n        // Transform API response\n        setNotifications(apiNotifications.map((n: any) => ({\n          id: n.id,\n          type: n.channel?.toLowerCase() || 'system',\n          title: n.title || 'Notification',\n          message: n.body || n.message || '',\n          time: formatTimeAgo(n.createdAt),\n          read: n.readAt !== null,\n          icon: getIconForType(n.channel),\n          iconColor: getColorForType(n.channel),\n        })));\n      } catch (err) {\n        console.error('Failed to fetch notifications:', err);\n      } finally {\n        setLoading(false);\n      }\n    }\n    fetchNotifications();\n  }, [user?.id]);\n\n  function formatTimeAgo(date: string): string {\n    const seconds = Math.floor((Date.now() - new Date(date).getTime()) / 1000);\n    if (seconds < 60) return 'Just now';\n    if (seconds < 3600) return `${Math.floor(seconds / 60)} minutes ago`;\n    if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`;\n    return `${Math.floor(seconds / 86400)} days ago`;\n  }\n\n  function getIconForType(type: string): string {\n    switch (type?.toLowerCase()) {\n      case 'orders': return 'ri-truck-line';\n      case 'promotions': return 'ri-fire-line';\n      case 'system': return 'ri-shield-check-line';\n      default: return 'ri-notification-line';\n    }\n  }\n\n  function getColorForType(type: string): string {\n    switch (type?.toLowerCase()) {\n      case 'orders': return 'text-emerald-600';\n      case 'promotions': return 'text-orange-600';\n      case 'system': return 'text-blue-600';\n      default: return 'text-gray-600';\n    }\n  }\n\n  const filterCounts = {\n    all: notifications.length,\n    orders: notifications.filter(n => n.type === 'orders').length,\n    promotions: notifications.filter(n => n.type === 'promotions').length,\n    system: notifications.filter(n => n.type === 'system').length\n  };\n\n  const filteredNotifications = activeFilter === 'all'\n    ? notifications\n    : notifications.filter(n => n.type === activeFilter);\n\n  const markAsRead = async (id: string) => {\n    try {\n      await notificationsService.markRead(id, user?.id || '');\n      setNotifications(notifications.map(n =>\n        n.id === id ? { ...n, read: true } : n\n      ));\n    } catch (err) {\n      console.error('Failed to mark as read:', err);\n    }\n  };\n\n  const markAllAsRead = async () => {\n    if (!user?.id) return;\n    try {\n      await notificationsService.markAllRead(user.id);\n      setNotifications(notifications.map(n => ({ ...n, read: true })));\n    } catch (err) {\n      console.error('Failed to mark all as read:', err);\n    }\n  };\n\n  const deleteNotification = async (id: string) => {\n    try {\n      await notificationsService.delete(id, user?.id || '');\n      setNotifications(notifications.filter(n => n.id !== id));\n    } catch (err) {\n      console.error('Failed to delete notification:', err);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex flex-col\">\n        <Header />\n        <div className=\"flex-1 max-w-4xl mx-auto w-full px-4 py-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">Notifications</h1>\n          <div className=\"space-y-3\">\n            {[...Array(5)].map((_, i) => <SkeletonLoader key={i} type=\"text\" />)}\n          </div>\n        </div>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex flex-col\">\n      <Header />\n\n      <div className=\"flex-1 max-w-4xl mx-auto w-full px-4 py-8\">\n        {/* Header */}\n        <div className=\"mb-6\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <h1 className=\"text-3xl font-bold text-gray-900\">Notifications</h1>\n            <button\n              onClick={markAllAsRead}\n              className=\"text-sm text-emerald-600 hover:text-emerald-700 font-medium whitespace-nowrap\"\n            >\n              Mark all as read\n            </button>\n          </div>\n          <p className=\"text-gray-600\">Stay updated with your orders and promotions</p>\n        </div>\n\n        {/* Filters */}\n        <div className=\"bg-white rounded-xl shadow-sm p-4 mb-6\">\n          <div className=\"flex flex-wrap gap-3\">\n            {(['all', 'orders', 'promotions', 'system'] as NotificationType[]).map(filter => (\n              <button\n                key={filter}\n                onClick={() => setActiveFilter(filter)}\n                className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${activeFilter === filter\n                  ? 'bg-emerald-600 text-white'\n                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                  }`}\n              >\n                {filter.charAt(0).toUpperCase() + filter.slice(1)} ({filterCounts[filter]})\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Notifications List */}\n        <div className=\"space-y-3\">\n          {filteredNotifications.length === 0 ? (\n            <div className=\"bg-white rounded-xl shadow-sm p-12 text-center\">\n              <i className=\"ri-notification-off-line text-6xl text-gray-300 mb-4\"></i>\n              <p className=\"text-gray-500\">No notifications in this category</p>\n            </div>\n          ) : (\n            filteredNotifications.map((notification) => (\n              <div\n                key={notification.id}\n                className={`bg-white rounded-xl shadow-sm p-4 transition-all hover:shadow-md ${!notification.read ? 'border-l-4 border-emerald-600' : ''\n                  }`}\n              >\n                <div className=\"flex items-start gap-4\">\n                  <div className=\"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0\">\n                    <i className={`${notification.icon} text-xl ${notification.iconColor}`}></i>\n                  </div>\n\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-start justify-between gap-4 mb-1\">\n                      <h3 className=\"font-semibold text-gray-900\">{notification.title}</h3>\n                      <span className=\"text-xs text-gray-500 whitespace-nowrap\">{notification.time}</span>\n                    </div>\n                    <p className=\"text-sm text-gray-600 mb-3\">{notification.message}</p>\n\n                    <div className=\"flex items-center gap-4\">\n                      {!notification.read && (\n                        <button\n                          onClick={() => markAsRead(notification.id)}\n                          className=\"text-xs text-emerald-600 hover:text-emerald-700 font-medium whitespace-nowrap\"\n                        >\n                          Mark as read\n                        </button>\n                      )}\n                      <button\n                        onClick={() => deleteNotification(notification.id)}\n                        className=\"text-xs text-red-600 hover:text-red-700 font-medium whitespace-nowrap\"\n                      >\n                        Delete\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n\n        {/* Settings Link */}\n        <div className=\"mt-8 text-center\">\n          <Link\n            to=\"/account/settings/notifications\"\n            className=\"inline-flex items-center gap-2 text-emerald-600 hover:text-emerald-700 font-medium\"\n          >\n            <i className=\"ri-settings-3-line\"></i>\n            Notification Settings\n          </Link>\n        </div>\n      </div>\n\n      <Footer />\n    </div>\n  );\n}\n"],"names":["notificationsService","userId","filters","params","query","buildQuery","api","id","NotificationsPage","user","useAuth","activeFilter","setActiveFilter","useState","notifications","setNotifications","loading","setLoading","useEffect","fetchNotifications","apiNotifications","n","formatTimeAgo","getIconForType","getColorForType","err","date","seconds","type","filterCounts","filteredNotifications","markAsRead","markAllAsRead","deleteNotification","jsxs","jsx","Header","_","i","SkeletonLoader","Footer","filter","notification","Link"],"mappings":"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"}