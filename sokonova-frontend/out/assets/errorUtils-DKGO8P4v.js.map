{"version":3,"file":"errorUtils-DKGO8P4v.js","sources":["../../src/lib/errorUtils.ts"],"sourcesContent":["/**\n * Error Utilities - Parse API errors into user-friendly messages\n */\n\nimport { ApiError } from './api';\n\n// HTTP status code to user-friendly message mapping\nconst STATUS_MESSAGES: Record<number, string> = {\n    400: 'Invalid request. Please check your input.',\n    401: 'Session expired. Please log in again.',\n    403: 'You don\\'t have permission to do this.',\n    404: 'The requested item was not found.',\n    409: 'This action conflicts with existing data.',\n    422: 'Please check your input and try again.',\n    429: 'Too many requests. Please wait a moment.',\n    500: 'Server error. Please try again later.',\n    502: 'Server is temporarily unavailable.',\n    503: 'Service is under maintenance. Please try again later.',\n};\n\n// Context-specific error messages\nconst CONTEXT_MESSAGES: Record<string, Record<number, string>> = {\n    login: {\n        401: 'Invalid email or password.',\n        404: 'Account not found.',\n    },\n    cart: {\n        404: 'Product no longer available.',\n        409: 'Item already in cart.',\n    },\n    order: {\n        402: 'Payment required.',\n        404: 'Order not found.',\n    },\n    product: {\n        404: 'Product not found or has been removed.',\n    },\n};\n\n/**\n * Extract user-friendly message from an error\n * @param error - The error object (ApiError, Error, or unknown)\n * @param context - Optional context for more specific messages (e.g., 'login', 'cart')\n * @returns User-friendly error message\n */\nexport function getErrorMessage(error: unknown, context?: string): string {\n    // Handle ApiError with server-provided message\n    if (error instanceof ApiError) {\n        // Check for server-provided message first\n        const serverMessage = extractServerMessage(error.data);\n        if (serverMessage) {\n            return serverMessage;\n        }\n\n        // Check context-specific messages\n        if (context && CONTEXT_MESSAGES[context]?.[error.status]) {\n            return CONTEXT_MESSAGES[context][error.status];\n        }\n\n        // Fall back to generic status messages\n        return STATUS_MESSAGES[error.status] || `Error ${error.status}: ${error.statusText}`;\n    }\n\n    // Handle network errors\n    if (error instanceof TypeError && error.message.includes('fetch')) {\n        return 'Network error. Please check your internet connection.';\n    }\n\n    // Handle standard errors\n    if (error instanceof Error) {\n        // Don't expose technical error messages to users\n        if (error.message.includes('timeout')) {\n            return 'Request timed out. Please try again.';\n        }\n        if (error.message.includes('abort')) {\n            return 'Request was cancelled.';\n        }\n    }\n\n    // Default fallback\n    return 'Something went wrong. Please try again.';\n}\n\n/**\n * Extract message from API error response data\n */\nfunction extractServerMessage(data: unknown): string | null {\n    if (!data || typeof data !== 'object') return null;\n\n    const errorData = data as Record<string, unknown>;\n\n    // Common API error response formats\n    if (typeof errorData.message === 'string') {\n        return errorData.message;\n    }\n\n    // NestJS validation errors\n    if (Array.isArray(errorData.message)) {\n        return errorData.message[0];\n    }\n\n    // Nested error object\n    if (errorData.error && typeof errorData.error === 'object') {\n        const nestedError = errorData.error as Record<string, unknown>;\n        if (typeof nestedError.message === 'string') {\n            return nestedError.message;\n        }\n    }\n\n    return null;\n}\n\n/**\n * Check if error is a network/connection error\n */\nexport function isNetworkError(error: unknown): boolean {\n    if (error instanceof TypeError && error.message.includes('fetch')) {\n        return true;\n    }\n    if (error instanceof ApiError && error.status === 0) {\n        return true;\n    }\n    return false;\n}\n\n/**\n * Check if error requires re-authentication\n */\nexport function isAuthError(error: unknown): boolean {\n    return error instanceof ApiError && error.status === 401;\n}\n\n/**\n * Check if error is a validation error\n */\nexport function isValidationError(error: unknown): boolean {\n    return error instanceof ApiError && (error.status === 400 || error.status === 422);\n}\n\n/**\n * Extract validation errors for form fields\n */\nexport function getValidationErrors(error: unknown): Record<string, string> {\n    if (!(error instanceof ApiError)) return {};\n\n    const data = error.data as Record<string, unknown> | undefined;\n    if (!data) return {};\n\n    // Handle NestJS class-validator format\n    if (Array.isArray(data.message)) {\n        const errors: Record<string, string> = {};\n        data.message.forEach((msg: string) => {\n            // Try to extract field name from message\n            const match = msg.match(/^(\\w+)\\s/);\n            if (match) {\n                errors[match[1]] = msg;\n            }\n        });\n        return errors;\n    }\n\n    // Handle errors object format\n    if (data.errors && typeof data.errors === 'object') {\n        return data.errors as Record<string, string>;\n    }\n\n    return {};\n}\n"],"names":["STATUS_MESSAGES","CONTEXT_MESSAGES","getErrorMessage","error","context","ApiError","serverMessage","extractServerMessage","data","errorData","nestedError"],"mappings":"wCAOA,MAAMA,EAA0C,CAC5C,IAAK,4CACL,IAAK,wCACL,IAAK,wCACL,IAAK,oCACL,IAAK,4CACL,IAAK,yCACL,IAAK,2CACL,IAAK,wCACL,IAAK,qCACL,IAAK,uDACT,EAGMC,EAA2D,CAC7D,MAAO,CACH,IAAK,6BACL,IAAK,oBAAA,EAET,KAAM,CACF,IAAK,+BACL,IAAK,uBAAA,EAET,MAAO,CACH,IAAK,oBACL,IAAK,kBAAA,EAET,QAAS,CACL,IAAK,wCAAA,CAEb,EAQO,SAASC,EAAgBC,EAAgBC,EAA0B,CAEtE,GAAID,aAAiBE,EAAU,CAE3B,MAAMC,EAAgBC,EAAqBJ,EAAM,IAAI,EACrD,OAAIG,IAKAF,GAAWH,EAAiBG,CAAO,IAAID,EAAM,MAAM,EAC5CF,EAAiBG,CAAO,EAAED,EAAM,MAAM,EAI1CH,EAAgBG,EAAM,MAAM,GAAK,SAASA,EAAM,MAAM,KAAKA,EAAM,UAAU,GACtF,CAGA,GAAIA,aAAiB,WAAaA,EAAM,QAAQ,SAAS,OAAO,EAC5D,MAAO,wDAIX,GAAIA,aAAiB,MAAO,CAExB,GAAIA,EAAM,QAAQ,SAAS,SAAS,EAChC,MAAO,uCAEX,GAAIA,EAAM,QAAQ,SAAS,OAAO,EAC9B,MAAO,wBAEf,CAGA,MAAO,yCACX,CAKA,SAASI,EAAqBC,EAA8B,CACxD,GAAI,CAACA,GAAQ,OAAOA,GAAS,SAAU,OAAO,KAE9C,MAAMC,EAAYD,EAGlB,GAAI,OAAOC,EAAU,SAAY,SAC7B,OAAOA,EAAU,QAIrB,GAAI,MAAM,QAAQA,EAAU,OAAO,EAC/B,OAAOA,EAAU,QAAQ,CAAC,EAI9B,GAAIA,EAAU,OAAS,OAAOA,EAAU,OAAU,SAAU,CACxD,MAAMC,EAAcD,EAAU,MAC9B,GAAI,OAAOC,EAAY,SAAY,SAC/B,OAAOA,EAAY,OAE3B,CAEA,OAAO,IACX"}